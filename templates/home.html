{% extends 'base.html' %}
{% load custom_filters %}
{% load static %}

{% block title %}Home - Cloud Stream{% endblock %}

{% block content %}
<style>
    /* --- HOME FEED SPECIFIC STYLES --- */
    
    /* Grid Layout - Responsive with wider gaps */
    .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 24px; /* Increased spacing */
        padding-bottom: 40px;
    }

    /* Card Styling Override */
    .video-card {
        background: transparent;
        border: 1px solid transparent;
        border-radius: 12px;
        transition: all 0.2s ease;
        position: relative;
        display: flex;
        flex-direction: column;
    }

    /* Hover Effect - Glow without "Bloat" */
    /* This replaces the scaling effect with a subtle mint glow */
    .video-card:hover {
        background: rgba(25, 25, 25, 0.6); 
        border-color: rgba(0, 242, 234, 0.3); /* Mint border */
        box-shadow: 0 0 20px rgba(0, 242, 234, 0.1); /* Soft glow behind */
        transform: translateY(-2px); /* Very subtle lift */
        z-index: 2;
    }

    /* Force disable image zoom if it's inherited from base.css */
    .video-card:hover .thumb img {
        transform: none !important; 
        filter: brightness(1.1);
    }

    /* Thumbnail Area */
    .thumb-wrapper {
        position: relative;
        width: 100%;
        padding-top: 56.25%; /* 16:9 Aspect Ratio */
        background: #1a1a1a;
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 12px;
    }
    
    .thumb-img {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        object-fit: cover;
    }

    /* Duration Badge */
    .duration-badge {
        position: absolute;
        bottom: 8px; right: 8px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        font-size: 11px; font-weight: 600;
        padding: 3px 6px;
        border-radius: 4px;
    }

    /* Info Section Layout */
    .video-info {
        display: flex;
        gap: 12px; /* Space between avatar and text */
        padding: 0 4px;
    }

    /* Profile Picture Slot */
    .creator-avatar {
        width: 36px; height: 36px;
        min-width: 36px; /* Prevent squishing */
        background: linear-gradient(135deg, #333, #222);
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        color: #666; font-size: 14px;
        border: 1px solid transparent;
        transition: 0.2s;
    }
    .video-card:hover .creator-avatar {
        border-color: var(--primary);
        color: var(--primary);
    }

    /* Text Content */
    .text-content {
        display: flex; flex-direction: column;
        width: 100%;
    }

    .video-title {
        color: var(--text-main);
        font-size: 15px;
        font-weight: 600;
        line-height: 1.4;
        margin-bottom: 6px;
        display: -webkit-box;
        -webkit-line-clamp: 2; /* Limit to 2 lines */
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        transition: color 0.2s;
    }
    .video-card:hover .video-title {
        color: var(--primary);
    }

    .channel-name {
        color: var(--text-muted);
        font-size: 13px;
        margin-bottom: 2px;
        display: flex; align-items: center; gap: 4px;
    }
    .channel-name:hover { color: white; }

    .meta-data {
        color: var(--text-muted);
        font-size: 12px;
    }

</style>

<!-- Filters / Tags (Optional Enhancement) -->
<div style="margin-bottom: 24px; display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; border-bottom: 1px solid #1a1a1a;">
    <button class="btn-outline-sm" style="background: var(--text-main); color: #000; border: none;">All</button>
    <button class="btn-outline-sm" style="border-color: #333; color: #888;">Gaming</button>
    <button class="btn-outline-sm" style="border-color: #333; color: #888;">Music</button>
    <button class="btn-outline-sm" style="border-color: #333; color: #888;">Tech</button>
    <button class="btn-outline-sm" style="border-color: #333; color: #888;">Live</button>
</div>

<!-- VIDEO GRID -->
<div class="video-grid">
    {% for video in videos %}
    <div class="video-card">
        <!-- 1. Thumbnail Container (16:9) -->
        <a href="{% url 'watch_video' video.video_id %}" class="thumb-wrapper">
            {% if video.thumbnail_key %}
                <img src="https://vinayfinalvidscloudstream.s3.amazonaws.com/{{ video.thumbnail_key }}" alt="{{ video.title }}" class="thumb-img">
            {% else %}
                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #222; color: #444;">
                    <i class="fa-solid fa-play" style="font-size: 30px;"></i>
                </div>
            {% endif %}
            
            <!-- Mock Duration (Since backend might not send it yet) -->
            <span class="duration-badge">12:45</span>
        </a>

        <!-- 2. Info Row -->
        <div class="video-info">
            <!-- Avatar Slot -->
            <a href="#" class="creator-avatar" title="View Channel">
                <i class="fa-solid fa-user"></i>
            </a>

            <!-- Text Data -->
            <div class="text-content">
                <a href="{% url 'watch_video' video.video_id %}" class="video-title">
                    {{ video.title }}
                </a>
                
                <a href="#" class="channel-name">
                    User Channel
                    <i class="fa-solid fa-circle-check" style="font-size: 10px; color: #888;" title="Verified"></i>
                </a>
                
                <div class="meta-data">
                    <span>1.2K views</span> â€¢ <span>{{ video.created_at | time_ago }}</span>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
        <!-- Empty State -->
        <div style="grid-column: 1 / -1; text-align: center; padding: 80px 20px;">
            <div style="width: 80px; height: 80px; background: #111; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 20px;">
                <i class="fa-solid fa-video-slash" style="font-size: 30px; color: #333;"></i>
            </div>
            <h3 style="color: white; margin-bottom: 10px;">No videos yet</h3>
            <p style="color: #666; max-width: 400px; margin: 0 auto 20px;">Get started by uploading your first video to the platform.</p>
            <a href="{% url 'get_upload_url' %}" class="btn-primary">Upload Video</a>
        </div>
    {% endfor %}
</div>

{% endblock %}